{% extends "admin_dashboard.html" %}

{% block title %} Admin Search {% endblock %}

{% block content %}
<div class="container my-5">
    <form action="{{url_for('admin_search')}}" class="d-flex p-3 bg-light shadow-sm rounded mb-4" method="post">
        <select name="table" id="" class="form-select me-2 w-25" required>
            <option selected value="">Search by</option>
            <option value="parkingLot">Parking Lot</option>
            <option value="parkingSpot">Parking Spot</option>
            <option value="users">Users</option>
            <option value="reservations">Reservations</option>
        </select>
        <input type="text" class="form-control me-2" placeholder="search ..." name="search_query" required>
        <button type="submit" class="btn btn-success">Search</button>
    </form>

    {% if table == 'users' %}
    <div class="bg-light rounded shadow-sm p-4 mb-5">
        <h4 class="text-center mb-3">Users</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Active</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in Users %}
                    <tr>
                        <td>{{user.id}}</td>
                        <td>{{user.username}}</td>
                        <td>{{user.email}}</td>
                        <td>
                            {% if user.active %}
                            <span class="badge text-bg-success">Yes</span>
                            {% else %}
                            <span class="badge text-bg-danger">No</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="text-center">No User Found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% elif table == "parkingLot" %}
    <div class="bg-light rounded shadow-sm p-4 mb-5">
        <h5 class="text-center mb-3">Parking Lots</h5>
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>Prime Location</th>
                        <th>Address</th>
                        <th>Pincode</th>
                        <th>Price</th>
                        <th>Capacity</th>
                        <th>Total Spots</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lot in ParkingLots %}
                    <tr>
                        <td>{{lot.id}}</td>
                        <td>{{lot.pl_name}}</td>
                        <td>{{lot.address}}</td>
                        <td>{{lot.pincode}}</td>
                        <td>{{lot.price}}</td>
                        <td>{{lot.capacity}}</td>
                        <td>{{lot.spots_count}}</td>
                        <td>
                            <a href="{{url_for('view_parking_lot', lot_id=lot.id)}}" class="btn btn-sm btn infor"></a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" class="text-center">No Lot Found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


    {% elif table == 'parkingSpot' %}
    <div class="bg-light rounded shadow-sm p-4 mb-5">
        <h4 class="text-center mb-3">Parking Spots</h4>
        <div class="table-responsive">
            <table class="table table-hover table-striped align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>Lot ID</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for spot in ParkingSpots %}
                    <tr>
                        <td>{{spot.id}}</td>
                        <td>{{spot.lot_id}}</td>
                        <td>
                            {% if spot.status == 'available' %}
                            <span class="badge text-bg-secondary">Available</span>
                            {% else %}
                            <span class="badge text-bg-success">Occupied</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{url_for('get_spot', spot_id=spot.id)}}" class="btn btn-sm btn-info">View</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="text-center">No Spots Found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


    {% elif table == 'reservations' %}
    <div class="bg-light rounded shadow-sm p-4 mb-5">
        <h4 class="text-center mb-3">Reservations</h4>
        <div class="table-responsive">
            <table class="table table-hover table-striped align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>Spot ID</th>
                        <th>User ID</th>
                        <th>Vehicle No.</th>
                        <th>Parking Time</th>
                        <th>Leaving Time</th>
                        <th>Price/hr</th>
                        <th>Cost</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in Reservations %}
                    <tr>
                        <td>{{r.id}}</td>
                        <td>{{r.spot_id}}</td>
                        <td>{{r.user_id}}</td>
                        <td>{{r.vrn}}</td>
                        <td>{{r.parking_timestamp.strftime('%d-%m-%Y | %H : %M')}}</td>
                        <td>{{r.leaving_timestamp.strftime('%d-%m-%Y | %H : %M')}}</td>
                        <td>{{r.spot.lot.price}}</td>
                        <td>{{r.parking_cost}}</td>
                        {% if r.status == 'unpaid' %}
                        <td>
                            <span class="badge text-bg-danger">Unpaid</span>
                        </td>
                        <td>
                            <a href="{{url_for('get_spot', spot_id=r.spot_id)}}" class="btn btn-sm btn-info"></a>
                        </td>
                        {% else %}
                        <td>
                            <span class="badge text-bg-success">Paid</span>
                        </td>
                        <td></td>
                        {% endif %}
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="10" class="text-center">No Reservations Found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}